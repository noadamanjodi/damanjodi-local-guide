<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Damanjodi Local Guide</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:'Segoe UI',Arial;
  background:linear-gradient(135deg,#eaf0ff,#ffffff);
  color:#1a1a1a;
}

/* HEADER */
header{
  text-align:center;
  padding:40px 20px;
  background:linear-gradient(135deg,#003f88,#0057d9);
  color:white;
}
header h1{margin:0;font-size:34px;}
header p{opacity:.9}

/* SEARCH */
.search-box{
  text-align:center;
  padding:15px;
}
.search-box input{
  width:90%;
  max-width:420px;
  padding:10px 14px;
  border-radius:25px;
  border:1px solid #b9c7e4;
  font-size:15px;
}

/* FILTERS */
.filters{text-align:center;padding:10px;}
.filters button{
  margin:6px;
  padding:8px 16px;
  border:none;
  border-radius:20px;
  background:#0057d9;
  color:white;
  cursor:pointer;
}
.filters button.active{background:#003f88}

/* GRID */
.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:28px;
}

/* CARD */
.card{
  background:rgba(255,255,255,0.85);
  border-radius:22px;
  box-shadow:0 14px 35px rgba(0,0,0,0.15);
  overflow:hidden;
  cursor:pointer;
  transition:.3s;
}
.card:hover{transform:translateY(-6px);}

/* IMAGE / SLIDER */
.slider{
  position:relative;
}
.slider img{
  width:100%;
  height:auto;
  max-height:260px;
  object-fit:contain;
  background:#f5f7ff;
}
.slider button{
  position:absolute;
  top:45%;
  background:rgba(0,0,0,0.5);
  color:white;
  border:none;
  padding:6px 10px;
  cursor:pointer;
  border-radius:50%;
}
.prev{left:8px}
.next{right:8px}

/* CONTENT */
.card-content{
  padding:18px;
}
.card-content h3{
  margin:0;
  color:#003f88;
}
.card-content p{
  margin:6px 0;
  font-size:14px;
}

/* ACTIONS */
.actions{
  margin-top:10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.actions a{
  padding:7px 14px;
  background:#0057d9;
  color:white;
  text-decoration:none;
  border-radius:20px;
  font-size:13px;
}
.actions a.secondary{
  background:#eaf0ff;
  color:#003f88;
}

/* EMERGENCY PANEL */
.emergency{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#d32f2f;
  color:white;
  padding:14px 18px;
  border-radius:30px;
  box-shadow:0 10px 30px rgba(0,0,0,.3);
  z-index:999;
}
.emergency a{
  color:white;
  font-weight:bold;
  text-decoration:none;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.modal-content{
  background:white;
  max-width:600px;
  width:90%;
  border-radius:18px;
  padding:20px;
}
.close{
  float:right;
  cursor:pointer;
  font-size:20px;
}
</style>
</head>

<body>

<header>
  <h1>Damanjodi Local Guide</h1>
  <p>Auto-updated township information</p>
</header>

<div class="search-box">
  <input type="text" id="search" placeholder="Search hospital, school, market...">
</div>

<div class="filters" id="filters"></div>
<section class="container" id="cards"></section>

<!-- EMERGENCY -->
<div class="emergency">
  üö® <a href="tel:108">Emergency 108</a>
</div>

<!-- DETAIL MODAL -->
<div class="modal" id="modal">
  <div class="modal-content" id="modalContent">
    <span class="close" onclick="closeModal()">‚úñ</span>
  </div>
</div>

<script>
const JSON_URL =
"https://raw.githubusercontent.com/noadamanjodi/noa-data/main/json/local_guide.json";

let allData = [];

fetch(JSON_URL)
.then(res => res.json())
.then(data => {
  allData = data;
  buildFilters(data);
  renderCards(data);
});

document.getElementById("search").oninput = e => {
  const q = e.target.value.toLowerCase();
  renderCards(allData.filter(d =>
    d.Name.toLowerCase().includes(q) ||
    d.Category.toLowerCase().includes(q)
  ));
};

function buildFilters(data){
  const cats = ["All", ...new Set(data.map(d => d.Category))];
  const f = document.getElementById("filters");
  f.innerHTML = "";

  cats.forEach((c,i)=>{
    const b = document.createElement("button");
    b.textContent = c;
    if(i===0) b.classList.add("active");

    b.onclick = ()=>{
      document.querySelectorAll(".filters button")
        .forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      renderCards(c==="All" ? allData : allData.filter(d=>d.Category===c));
    };
    f.appendChild(b);
  });
}

function renderCards(data){
  const c = document.getElementById("cards");
  c.innerHTML = "";

  data.forEach(d=>{
    const photos = (d.Photos && d.Photos.length) ? d.Photos : [d.Photo_Link];

    c.innerHTML += `
      <div class="card" onclick='openModal(${JSON.stringify(d)})'>
        <div class="slider">
          <img src="${photos[0]}" data-photos='${JSON.stringify(photos)}' data-index="0">
          ${photos.length>1 ? `
            <button class="prev" onclick="event.stopPropagation();slide(this,-1)">‚Äπ</button>
            <button class="next" onclick="event.stopPropagation();slide(this,1)">‚Ä∫</button>
          ` : ""}
        </div>

        <div class="card-content">
          <h3>${d.Name}</h3>
          <p>${d.Description}</p>
          <p>‚òéÔ∏è ${d.Contact}</p>
          <div class="actions">
            <a href="${d.Map_Link}" target="_blank">üìç Map</a>
            <a class="secondary" href="tel:${d.Contact}">Call</a>
          </div>
        </div>
      </div>
    `;
  });
}

function slide(btn,dir){
  const img = btn.parentElement.querySelector("img");
  const photos = JSON.parse(img.dataset.photos);
  let idx = parseInt(img.dataset.index);
  idx = (idx + dir + photos.length) % photos.length;
  img.src = photos[idx];
  img.dataset.index = idx;
}

function openModal(d){
  document.getElementById("modalContent").innerHTML = `
    <span class="close" onclick="closeModal()">‚úñ</span>
    <h2>${d.Name}</h2>
    <p>${d.Description}</p>
    <p>‚òéÔ∏è ${d.Contact}</p>
    <p><a href="${d.Map_Link}" target="_blank">üìç View on Map</a></p>
  `;
  document.getElementById("modal").style.display = "flex";
}
function closeModal(){
  document.getElementById("modal").style.display = "none";
}
</script>

</body>
</html>
